# OA-workflow
The provided Python script is a pipeline for processing and analyzing images of  vascularization using the Amira / Avizo software.  
 It  applies a series of filters and processing techniques to enhance medical image data and extract meaningful information. It utilizes features provided by the Amira / Avizo software to perform these operations and save the results for further analysis.

---
For each file, it applies a Hessian filter to enhance the image structure.  
We apply this filter to enhance the tubular and elongated structures of the blood vessels. A Hessian matrix is calculated from each voxel of the input image, which reflects the changes of the intensity in different directions around a specific point. 
Thus it is a filter that allows better structure visualization.
[Dirk-Jan Kroon (2023). Hessian based Frangi Vesselness filter (https://www.mathworks.com/matlabcentral/fileexchange/24409-hessian-based-frangi-vesselness-filter) ].  

MAX and MIN are the maximum and minimum radius of the structure respectively (shown in voxels). STD (shown in voxels) represents the standart deviation of the measurement that we use to identify our object. It is preferable for the STD value to be > voxel size.  

---
Next, it applies an unsharp mask filter to further enhance image details.
This filter is applied to reduce the impact of noise and to preserve the fine structures that can be easily lost in subsequent stages of image processing. It works by applying a smoothing filter to the original image to create its blurred version. After that, the original image is subtracted from the blurred image to enhance the contrast and sharpness of the blood vessel edges. The edge size and the edge contrast must be adjusted [in accordance with the image analyzed.] 


The filtered files are renamed to indicate the applied filters.

Volume rendering is further performed on the filtered files.

Ranges for intensity rendering are collected to determine appropriate rendering ranges for each file.

The volume rendering parameters are adjusted based on the autoranges.  
Interactive thresholding is applied to the filtered files using the adjusted for threshold rendering ranges.

Also we can vary the threshold mode to specify it automatically or related to root images used for threshold recalculation.

Pruning filtering and Centrline tree reconstruction are performed on the thresholded binary images.

Statistics are collected using Spatial Graph Statistics on the Centrline tree calculations results.

The project is autosaved in Amira/Avizo format.

Attribute graphs generated by Spatial Graph Statistics are exported as XML files.

---

><font size='4'>Image preprocessing</font>
1. Nifti dimentions converter  
  1.1. Uploads file from 'folder_path'  
  1.2. Returns converted files to 'out_path' folder

The 'matlab_script_converter_nifti', 'folder_path' and 'out_path' need to be defined  
The script retrieves a list of files from a specified directory. 

It uploads files from 'folder_path', converts them using Nifti dimentions converter - a MATLAB script that allows file conversion into the .nii format. 

Upon conversion the script returns the converted files to 'out_path' folder.


>2. Paths and tags  
  2.1. Define the path to the folder with images  
  2.2. Select the files of interest by specifying the 'tag'  


During this step we can select the files of interest by specifying the 'tag', which should be a part of the file name. This function creates a new folder with the name specified by the tag parameter within the given folder path.

3. Image preparation

1.   Provide the path and tag of files to the Avizo console
2.   Run the cell and paste the following text output into Avizo console



After the images are sorted into a separate folder according to the tag, we can move to the Image preparation  which includes providing the path and tag of files to the Avizo console and ROI selection.
